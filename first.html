<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>game</title>
    <style>
        #canvas{
            border:1px solid #666;
        }
    </style>
</head>
<body>
<canvas id="canvas" width="400" height="300"></canvas>

<script>
    var log = console.log.bind(console);

    var Ball = function() {
        var  o = {
            image:null,
            x:100,
            y:150,
            speedX:2,
            speedY:5,
            fired:false
        };

        o.loadImage = function (src) {
            var img = new Image()
            img.src = src;
            o.image = img;
        }

        o.reverseX = function(){
            o.speedX *= -1;
        }
        o.reverseY = function(){
            o.speedY *= -1;
        }
        o.move = function(){
            o.fired= true;
            o.x += o.speedX;
            o.y += o.speedY;
        }
        o.stop = function(){
            o.fired= false;
        }

        return o;
    }

    var Paddle = function() {
        var  o = {
            image:null,
            x:100,
            y:250,
            speed:5
        };

        o.loadImage = function (src) {
            var img = new Image()
            img.src = src;
            o.image = img;
        }
        o.moveLeft = function(){
            o.x -= o.speed;
        }
        o.moveRight = function(){
            o.x += o.speed;
        }

        o.collide = function(ball){
            if(ball.y + ball.image.height >= o.y
                && ball.x + ball.image.width >= o.x){
                return true;
            }
            return false;
        }
        return o;
    }

    var Game = function() {
        var g = {
            canvas: null,
            context: null,
            currentKey:null,
            paddle:null,
            ball:null
        };

        g.init = function(canvas,paddle,ball){
            g.canvas = canvas;
            g.context = canvas.getContext("2d");
            g.paddle = paddle;
            g.ball = ball;
        }
        g.updatePosition = function () {
            if(g.currentKey == "a"){
                g.paddle.moveLeft();
            }else if (g.currentKey == "d"){
                g.paddle.moveRight();
            }else if (g.currentKey == "f"){
                g.ball.fired = true;
            }else if (g.currentKey == "g"){
                g.ball.stop();
            }
        }
        g.draw = function () {
            g.updatePosition();
            g.context.clearRect(0,0,g.canvas.width,g.canvas.height);

            g.context.drawImage(g.paddle.image,g.paddle.x,g.paddle.y);

            if (g.ball.x <= 0
                || g.ball.x + g.ball.image.width >= g.canvas.width
            || g.paddle.collide(g.ball)) {
                g.ball.reverseX();
            }
            if (g.ball.y <= 0
                || g.ball.y + g.ball.image.height >= g.canvas.height
            || g.paddle.collide(g.ball)) {
                g.ball.reverseY();
            }
            if (g.ball.fired) {
                g.ball.move();
            }
            g.context.drawImage(g.ball.image, g.ball.x, g.ball.y);

        }
        g.start = function () {
            var run = function(){
                g.draw();
                requestAnimationFrame(run);
            }
            run();
        }

        window.addEventListener("keydown",(e)=>{
            g.currentKey = e.key;
        });
        window.addEventListener("keyup",()=>{
            g.currentKey = null;
        });

        return g;
    }

    var __main = function(){
        var p = Paddle();
        p.loadImage("./img/button.png");

        var b = Ball();
        b.loadImage("./img/ball.png");

        var g = Game();
        var canvas = document.getElementById("canvas");
        g.init(canvas,p,b);
        g.start();

    }

    __main();

</script>
</body>
</html>